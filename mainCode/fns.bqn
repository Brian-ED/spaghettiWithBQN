_While_ â‡{ğ”½âŸğ”¾âˆ˜ğ”½_ğ•£_ğ”¾âˆ˜ğ”½âŸğ”¾ğ•©}
ToInt â‡10âŠ¸Ã—âŠ¸+ËœÂ´âˆ˜âŒ½-âŸœ'0'
StartsWith â‡ â‰¤â—‹â‰ â—¶âŸ¨0â‹„âŠ£â‰¡â‰ âŠ¸â†‘âŸ©Ëœ
Print â‡âŠ¢âŠ£  (â€¢pathâˆ¾"/../out.txt") â€¢FChars â€¢Repr
IsString â‡(1==)â—¶âŸ¨0â‹„âˆ§Â´2=â€¢TypeÂ¨âŸ©
ToPyTuple â‡{'['âˆ¾']'Â«âˆ¾1âŒ½Â¨""","""âŠ¸âˆ¾âŸœâˆ¾Â¨"\"""âŠ¸(âŠ‘âŠ)â—¶"\\"â€¿"\"""â€¿â¥ŠÂ¨Â¨ğ•©}
PrefixedInteger â†âŠ¢(âŠ¢âˆ¾âŸœToInt 1â†“â†‘Ëœ)1+âŸœ(+Â´âˆ§`)1â†“âˆŠâŸœ('0'+â†•10)
Splitâ†(âŠ¢-Ëœ+`Ã—Â¬)âˆ˜=âŠ”âŠ¢
Sâ†â€¢Show
ToIntsâ†ToIntÂ¨' 'SplitâŠ¢

# TODO add .run so you can use python function in bqn
PyFunc â‡{
  ğ•ŠfuncName:
  !IsString ğ•©
  "applyPyFunc" comm.SendMsg funcNameâŠ¸â‹ˆ
}

xâ€¿yâ†PyFuncÂ¨ "hello"â€¿"hi"
â€¢Show xâ€¿y

ExtractTypes â†{
  IsString ğ•©? 's';
  0=â€¢Type ğ•©?
    âˆ¾Â´('l'Â»Â«""âˆ¾Â´' 'âˆ¾Â¨â€¢ReprÂ¨â‰¢ğ•©)âˆ¾âˆ¾Â´ğ•ŠÂ¨â¥Šğ•©;
  "ncf"âŠ‘Ëœ2âŒŠÂ¯1+â€¢Type ğ•©
}

Crunchâ†{
  xâ†âŸ¨âŸ©
  IsStringâ—¶{
    xâˆ¾â†©â€¢ReprâŸ(2â‰ â€¢Type)Â¨â¥Šğ•©
  }â€¿{
    xâˆ¾â†©<ğ•©
  }âš‡1ğ•©
  x
}

IntoMediary â‡{
  ğ•Š: (ExtractTypes <âŠ¸âˆ¾ Crunch) ğ•©;
  ğ•Šâ¼:
    types â†âŠ‘ğ•©
    args â†1â†“ğ•©
    
    typesInShapeâ†âŠ‘âŸ¨âŸ©â‰¡âŸœ'l'â—¶âŸ¨
      âˆ¾Ëœ
      {-+Â´ğ•©âˆŠ' 'âˆ¾'0'+â†•10}(ToIntsâˆ˜â†‘(âŒ½<âˆ˜â¥Šâˆ¾Ã—Â´âŠ¸â†“)âŒ½âˆ˜â†“)âŠ¢
    âŸ©Â´types

    args GroupTypes typesInShape
}

GroupTypesâ†{argsğ•ŠtypesInShape:
  xâ†ğ•¨
  Fâ†{ğ•Š:(xâŒ½Ëœâ†©1)âŠ¢âŠ‘x}

  {(F@){ğ•ğ•¨}ToIntâ€¿âŠ¢â€¿âŠ‘â€¿â€¢BQNâ€¿ PyFuncâŠ‘ËœâŠ‘"nscfF"âŠğ•©}âš‡0 ğ•©
}

{ğ•Š:
S SâŒ¾IntoMediary SâŸ¨"helllo"â‹„âŸ¨1â‹„2â‹„3â‹„âŸ¨'a'â‹„"boo"âŸ©â‹„4âŸ©âŸ©
}âŸ1@ #testing on or off

FileExistsâ†âŠ¢âŠ£"Couldn't find python file to run"!â€¢file.Exists

commâ‡{

  commPathâ‡"comm/Default"
  â€¢file.Existsâ—¶âŸ¨
    â€¢file.CreateDir
    â€¢file.RemoveÂ¨<âˆ˜âˆ¾âŸœ'/'âˆ¾Â¨â€¢file.List
  âŸ©commPath
  â€¢SH "Python3" â‹ˆ FileExistsğ•¨

  SetIDâ‡{
    "Only strings as name of communication allowed"!IsStringğ•©
    (âˆ§Â´ğ•©âˆŠ"_"âˆ¾â¥Š"aA"+âŒœâ†•26)!Ëœ"only alphabetical characters and spaces as name of communication allowed"
    commPathâ†"comm/"âˆ¾ğ•©
  }

  MsgExistsâ‡{ğ•Š:"TODO"}

  SendMsg â‡ {
    actionğ•Šmsg:
      !actionâˆŠâŸ¨"applyPyFunc"âŸ©
      pathâ†commPathâˆ¾"/msgFromBQN"âˆ¾actionâˆ¾(â€¢Reprâ‰ â€¢file.List commPath)âˆ¾".txt"
      path â€¢FChars ToPyTuple IntoMediary msg;
    ğ•Šmsg:
      pathâ†commPathâˆ¾"/msgFromBQN"âˆ¾(â€¢Reprâ‰ â€¢file.List commPath)âˆ¾".txt"
      path â€¢FChars ToPyTuple IntoMediary msg;
    ğ•Šâ¼:
      GetMsg 1
  }

  noMsgErrorâ†"No msg found. Please âŠ if expected, or 'GetMsg 1' to wait for msg"
  GetMsg â‡{
    waitâ†1â‰¡ğ•©
    FindFileâ†"msgFromPy"âŠ¸(âŠ£â‰¡â‰ âŠ¸â†‘)Â¨â€¢file.List
    mâ†FindFile _while_{â€¢Delay 0.2â‹„Â¬âˆ¨Â´ğ•©}âŸwait FindFile commPath
    noMsgError!âˆ¨Â´m
    fileâ†âŠ‘âˆ§m/â€¢file.List commPath
    (â€¢file.RemoveâŠ¢IntoMediaryâ¼âˆ˜â€¢FChars) file
  }
}